<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeÃ§miÅŸ Ã–zetlerim - ArticleSumm</title>
    <link rel="stylesheet" href="/css/styles.css"> <script src="/js/script.js" defer></script> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
    <div class="site-content"> <main class="container">
            <section class="card"> <h2>GeÃ§miÅŸ Ã–zetlerim</h2>

                <div id="history-list-container">
                    <p id="loading-message">Ã–zetler yÃ¼kleniyor...</p>
                    <div id="history-list">
                        </div>
                     <p id="no-history-message" style="display: none;">HenÃ¼z oluÅŸturulmuÅŸ bir Ã¶zetiniz bulunmuyor.</p>
                     <div id="history-error-message" style="color: red; display: none;"></div> </div>

                </section>
        </main>
    </div> <footer>
        <div class="footer-content">
          <p>Â© 2025 ArticleSumm | TÃ¼m HaklarÄ± SaklÄ±dÄ±r.</p>
          <div class="social-media">
             </div>
          <p class="contact-info">
            <i class="fas fa-envelope"></i> contact@articlesumm.com
          </p>
        </div>
      </footer>

      <div id="feedback-widget">
        <div id="feedback-toggle">ğŸ“ Geri Bildir</div>
        <div id="feedback-box" class="hidden">
          <h4>Platformu nasÄ±l buldunuz?</h4>
          <div id="star-rating">
            <span class="star" data-value="1">â˜†</span>
            <span class="star" data-value="2">â˜†</span>
            <span class="star" data-value="3">â˜†</span>
            <span class="star" data-value="4">â˜†</span>
            <span class="star" data-value="5">â˜†</span>
          </div>
          <textarea id="comment" placeholder="Yorum (isteÄŸe baÄŸlÄ±)"></textarea><br>
          <button id="submit-feedback">GÃ¶nder</button>
          <div id="thankYou" class="hidden">ğŸ‰ TeÅŸekkÃ¼rler! Geri bildiriminiz alÄ±ndÄ±.</div>
        </div>
      </div>

       <script>
        // Silme iÅŸlemi iÃ§in global fonksiyon
        async function handleDelete(ozetId) {
            const historyListDiv = document.getElementById('history-list');
            const noHistoryMessage = document.getElementById('no-history-message');
            const errorMessageDiv = document.getElementById('history-error-message');

            if (!confirm(`${ozetId} ID'li Ã¶zeti silmek istediÄŸinizden emin misiniz?`)) {
                return;
            }
            
            console.log(`${ozetId} ID'li Ã¶zet siliniyor...`);
            
            try {
                const token = getToken(); // script.js'den
                if (!token) throw new Error("LÃ¼tfen giriÅŸ yapÄ±n.");

                const response = await fetch(`/api/ozetler/${ozetId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                     let errorDetail = 'Silme iÅŸlemi baÅŸarÄ±sÄ±z.';
                     try {
                         const errorData = await response.json();
                         errorDetail = errorData.detail || errorDetail;
                     } catch (e) { /* JSON parse hatasÄ± olabilir */ }
                     throw new Error(errorDetail);
                }

                // BaÅŸarÄ±lÄ± silme sonrasÄ± ilgili elementi sayfadan kaldÄ±r
                const itemToRemove = historyListDiv.querySelector(`[data-id="${ozetId}"]`);
                if (itemToRemove) {
                    itemToRemove.remove();
                }
                // Liste boÅŸ kaldÄ±ysa mesajÄ± gÃ¶ster
                if(historyListDiv.children.length === 0) {
                     noHistoryMessage.style.display = 'block';
                }
                errorMessageDiv.style.display = 'none';

            } catch (error) {
                console.error('Silme hatasÄ±:', error);
                errorMessageDiv.textContent = error.message || 'Ã–zet silinirken bir hata oluÅŸtu.';
                errorMessageDiv.style.display = 'block';
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            // Bu korumalÄ± bir sayfa, token yoksa login'e yÃ¶nlendir
            checkLoginStatus(true); 

            const historyListDiv = document.getElementById('history-list');
            const loadingMessage = document.getElementById('loading-message');
            const noHistoryMessage = document.getElementById('no-history-message');
            const errorMessageDiv = document.getElementById('history-error-message');

            async function fetchHistory() {
                console.log("GeÃ§miÅŸ Ã¶zetler Ã§ekiliyor...");
                loadingMessage.style.display = 'block'; 
                noHistoryMessage.style.display = 'none';
                errorMessageDiv.style.display = 'none';
                historyListDiv.innerHTML = ''; 

                try {
                    const token = getToken(); // script.js'den
                    if (!token) {
                        throw new Error("LÃ¼tfen giriÅŸ yapÄ±n.");
                    }

                    const response = await fetch('/api/ozetler/', { //
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    if (!response.ok) {
                        const data = await response.json();
                        throw new Error(data.detail || 'Ã–zetler alÄ±namadÄ±.');
                    }
                    
                    const data = await response.json(); 

                    loadingMessage.style.display = 'none'; 

                    if (data && data.length > 0) {
                        // Ã–zetleri ters sÄ±rada (en yeni en Ã¼stte) gÃ¶ster
                        data.reverse().forEach(item => {
                            const itemElement = document.createElement('div');
                            itemElement.classList.add('history-item');
                            itemElement.dataset.id = item.id; // Silme iÅŸlemi iÃ§in

                            const tagsHtml = item.etiketler
                                ? item.etiketler.split(',').map(tag => `<span>${tag.trim()}</span>`).join('')
                                : ''; 

                            // TÄ±klama olayÄ± eklendi (summary.html'e yÃ¶nlendirme)
                            itemElement.innerHTML = `
                                <div class="history-item-content" data-id="${item.id}">
                                    <h4><a href="/summary.html?id=${item.id}">${item.baslik || 'BaÅŸlÄ±ksÄ±z Ã–zet'}</a></h4>
                                    <div class="history-tags">
                                        ${tagsHtml}
                                    </div>
                                </div>
                                <div class="history-item-actions">
                                    <button class="delete-button" onclick="handleDelete(${item.id})">Sil</button>
                                </div>
                            `;
                            historyListDiv.appendChild(itemElement);
                        });
                    } else {
                        noHistoryMessage.style.display = 'block'; // Ã–zet yok
                    }

                } catch (error) {
                    console.error('GeÃ§miÅŸ yÃ¼klenirken hata:', error);
                    loadingMessage.style.display = 'none';
                    errorMessageDiv.textContent = error.message || 'Ã–zetler yÃ¼klenirken bir hata oluÅŸtu.';
                    errorMessageDiv.style.display = 'block';
                }
            }

            // Sayfa yÃ¼klendiÄŸinde geÃ§miÅŸi Ã§ek
            fetchHistory();
        });
       </script>

</body>
</html>